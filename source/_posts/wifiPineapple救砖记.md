---
title: wifiPineapple救砖记
date: 2019-03-01 15:55:40
tags:
---
去年对渗透测试很有兴趣的时候买了一个`wifipineapple`然后就开始了吃灰，昨晚拿出来玩了一会儿，发现二道子卖家同步更新到了官方2.4.2的版本，所以就想着升级一下，也是手贱，升级前想着用编程器把之前的固件保存下来，结果第二次用编程器，想偷懒没拆下flash就直接上了编程器读取固件，结果噩梦开始了。


不拆下flash直接上编程器，编程器上电的时候也带着soc一起工作了，结果就是编程器始终无法正确读取到flash的内容，想着既然没办法保存那就算了，然后就把主控又放了回去，结果就开不开机了，开机串口没打印了，顿时就慌了。

没办法只能把flash拆下来，用编程器重新读取了下，这次就能正常读取数据了，
下次一定注意 *使用编程器的时候一定要把flash拆下来* 

现在重新保存编程器的固件，dump出16M的文件，用winhex读取，预计前面的uboot出现了问题，导致无法成功引导，在刷了几个固件再焊到主控上的过程中，因为烙铁操作太暴力还把焊盘弄掉了，看来买风枪需要提上日程了。

![焊盘掉了两个](/img/IMG_028.JPG)

查了下winbond的flash的datasheet，发现其中一个是wp接口，路由器上肯定是接个下拉或者直接接地的，另外一个写的接口，这个口肯定不能少，用万用表打了一下，在板子反面找到了对应的过口，飞线接上，也不敢再这么瞎搞了，找到一片能兼容sop8的焊盘飞线搞定，热熔胶还正好用完了，只好双面胶固定焊点。

![双面胶大法](/img/IMG_0281.JPG)

查了主控是ar9331，原来跟我的wr720n是一个主控，以前啥都不知道就瞎买，现在终于懂了些，以后这些玩意儿应该不会被坑太多了。。

反正就是刷了很多ar9331的uboot，但是都没办法成功引导板子，最后想到了[`breed`](https://www.right.com.cn/forum/thread-161906-1-1.html)，breed 是支持ar9331的，在下载ar9331的通用引导文件，随后在winhex中新建一个16m的空白文件，先把所有的block都填充为FF(CTRL+A –> CTRAL+L),从`00000000`地址开始写写入breed，写128kb，随后在`20000`的偏移量地址开始写wifipineaplle的升级包(http://zy-link.xyz:8001/nano/fw/)，升级包是一开始路由器还能正常工作的时候用路由器连接360wifi然后wireshark抓包抓到的，最后到偏移量`FF0000`地址

    *4M固件应写在偏移量3F0000 
    *8M固件应写在偏移量7F0000 
    *16M固件应写在偏移量FF0000

然后用一开始提取出的art文件写入最后64k文件，最后保存这个16M的固件文件，保存后使用编程器写入到flash中，把flash重新连接主控，插上串口，上电，开机，看到窗口又在走字，就知道应该是救砖成功了。

![串口打印](/img/Snipaste_2019-03-01_17-44-21.png)

 至此，wifipineapple救砖成功。

 接下来想到既然是ar9331主控，那我的wr720n是不是也可以使用wifipineapple的固件？
 不过目前有个问题就是这个固件是16m的但是我的wr720n只有8m的内置存储，需要一个16m的flash也应该容易，淘宝2块钱，但是周末就快到了，是时候再去一趟花鸟市场捡捡垃圾了，说不定能捡到一个呢。